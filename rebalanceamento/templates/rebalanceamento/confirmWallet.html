{% extends 'rebalanceamento/base.html' %}
{% block content %}

<div class="d-flex align-items-center flex-column">
Confirme o valor do aporte, o ticker, a quantidade de ações e as porcentagens de cada ativo:<br><br>
    <form action="{% url 'confirmWallet' %}" method="post">
        {% csrf_token %}
        <div class="form-group col-6 m-0 pl-0">
            <table class="table table-sm table-hover">
                {{capitalForm.as_table}}
            </table>
        </div>

        {{walletFormSet.management_form}}
        <table id="formset-table-empty" style="display: none">
            {{walletFormSet.empty_form}}
        </table>

        <table class="table  table-hover">
            <thead>
                {% for form in walletFormSet %}
                    {% if forloop.first %}
                        {% for field in form %}
                            <th scope="col">{{ field.label_tag }}</th>
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            </thead>
            <tbody class="walletForm">
                {% for form in walletFormSet %}
                    <tr class="dynamic-form">
                        {% for field in form %}
                            <td>{{ field }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
                <tr class="dynamic-form"> </tr>
            </tbody>
        </table>
        {% for form in walletFormSet %}
            {% for key, errorList in form.errors.items %}
                {{errorList}}
            {% endfor %}
        {% endfor %}
        <button type="button" class="add-row btn btn-primary ">
            +
        </button>
        <button type="button" class="delete-row btn btn-primary ">
            -
        </button>
        <input class="btn btn-primary" type="submit" value="Confirmar">
    </form>
</div>
{% endblock %}

{% block extraScripts %}
{{ walletFormSet.media }}

<script>
    $('.add-row').click(function() {
        var index = $('#id_form-TOTAL_FORMS').val();
        var newRow = $('#formset-table-empty').clone(true);
        newRow.find(':input').each(function() {
            for (attr of ['name', 'id'])
                $(this).attr(
                    attr,
                    $(this).attr(attr).replace('__prefix__', index)
                )
        });
        var lastRow = $(".dynamic-form:last");
        lastRow.clone().appendTo('.walletForm');
        newRow.find('td').appendTo(lastRow);
        $('#id_form-TOTAL_FORMS').val(
            parseInt($('#id_form-TOTAL_FORMS').val()) + 1
        );
    });
    function deleteForm(btn) {
        if ($('.dynamic-form').length > 2){
            $('.dynamic-form:last').prev().remove();
            $('#id_form-TOTAL_FORMS').val(
            parseInt($('#id_form-TOTAL_FORMS').val()) - 1
            );
        }
    }
    $('.delete-row').click(function() {
        return deleteForm(this);
    });
</script>
 

{% endblock %}